(()=>{"use strict";function e(){chrome.tabs.query({},(e=>{for(let t of e)"url"in t&&chrome.scripting.executeScript({target:{tabId:t.id},files:["themesong-content.js"]})}))}const t=function(e){const t=new OffscreenCanvas(128,128).getContext("2d");t.clearRect(0,0,128,128),t.beginPath(),t.roundRect(0,4,128,120,20),t.fillStyle=e.lightDominant,t.fill(),t.beginPath(),t.rect(0,24,128,80),t.fillStyle=e.darkDominant,t.fill(),t.beginPath(),t.arc(45,64,35,0,2*Math.PI),t.fillStyle=e.secondary,t.fill(),t.beginPath(),t.moveTo(65,64),t.lineTo(32,86),t.lineTo(32,42),t.fillStyle=e.darkDominant,t.fill(),t.beginPath(),t.roundRect(90,32,28,14,5),t.fillStyle="#FFAAF6",t.fill(),t.beginPath(),t.roundRect(90,55,28,14,5),t.fillStyle="#1CBBFF",t.fill(),t.beginPath(),t.roundRect(90,80,28,14,5),t.fillStyle="#FFC700",t.fill();const o=t.getImageData(0,0,128,128);chrome.action.setIcon({imageData:o})};chrome.runtime.onInstalled.addListener((function(t){let o=chrome.i18n.getMessage("@@ui_locale"),n="chrome";switch(n=navigator.userAgent.toLowerCase().includes("firefox")?"firefox":"chrome",t.reason){case"install":chrome.storage.local.get("extensionPrefs",(e=>{chrome.storage.local.set({extensionPrefs:{...e.extensionPrefs,locale:o,browser:n}})})),e();break;case"update":chrome.storage.local.get("extensionPrefs",(e=>{chrome.storage.local.set({extensionPrefs:{...e.extensionPrefs,showUpdateNote:!1}})})),e();break;default:e()}})),chrome.runtime.onMessage.addListener((function(o,n,i){if("string"==typeof o)switch(o){case"reset":chrome.storage.local.clear(),e(),i("Reset to defaults"),window.location.reload();break;case"openSidePlayer":chrome.tabs.query({},(e=>{chrome.sidePanel.open({windowId:e[0].windowId}),chrome.windows.update(e[0].windowId,{focused:!0})}));break;default:i("It's a me, the background script!")}else if("object"==typeof o)for(let[e,n]of Object.entries(o))switch(e){case"notify":chrome.notifications.create(null,{type:"basic",iconUrl:n.songImg||"/assets/icon-128.png",title:n.songName,message:n.songArtist,buttons:[{title:"â­ï¸"}],silent:!0},(e=>setTimeout((()=>{chrome.notifications.clear(e)}),15e3)));break;case"iconColor":try{t(n)}catch{}break;case"search":chrome.search.query({disposition:"NEW_TAB",text:n});break;default:i("It's a me, the background script!")}})),chrome.notifications.onButtonClicked.addListener(((e,t)=>{chrome.tabs.query({},(e=>{let t=e.filter((e=>"url"in e));chrome.tabs.sendMessage(t[0].id,{message:"next-button"})}))}))})();